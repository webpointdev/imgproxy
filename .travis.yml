language: go

go:
  - '1.8'
  - '1.9'
  - '1.10'
  - '1.11'
  - tip

env:
  - VIPS_VERSION=8.4.6
  - VIPS_VERSION=8.5.8

cache: apt

install:
  - sudo apt-get -qq update
  - sudo apt-get install -y build-essential libxml2-dev libfftw3-dev gobject-introspection libglib2.0-dev libwebp-dev libgif-dev
  - wget https://github.com/jcupitt/libvips/releases/download/v$VIPS_VERSION/vips-$VIPS_VERSION.tar.gz
  - tar -xzvf vips-$VIPS_VERSION.tar.gz
  - pushd vips-$VIPS_VERSION
  - >
    ./configure
    --prefix=/usr
    --without-python
    --without-gsf
    --without-orc
    --disable-debug
    --disable-dependency-tracking
    --disable-static
    --enable-silent-rules
    --enable-gtk-doc-html=no
    --enable-gtk-doc=no
    --enable-pyvips8=no
  - make
  - sudo make install
  - popd

script:
  - CGO_LDFLAGS_ALLOW="-s|-w" go build
